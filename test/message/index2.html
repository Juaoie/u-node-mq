<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body id="body">
    <div id="ex2">
      <h3>ex2模块</h3>
    </div>
    <style>
      body {
        background-color: aquamarine;
      }
    </style>
  </body>
  <script type="module">
    import IframeMessage from "../../dist/plugins/iframe/index.js";
    import UNodeMQ, { Exchange, Queue } from "../../dist/index.js";
    const unmq = new UNodeMQ(
      {
        ex1: new Exchange(),
        ex2: new Exchange({ routes: ["qu2"] }),
        ex3: new Exchange(),
        ex4: new Exchange(),
      },
      {
        qu2: new Queue(),
      }
    );
    unmq.use(new IframeMessage("ex2"));

    unmq.on("qu2", (res) => {
      alert("ex2收到：" + res);
    });

    const body = document.getElementById("ex2");
    const button = document.createElement("button");
    button.innerText = "挂载ex3";
    button.onclick = () => {
      if (window.self.length === 1) return;
      const iframe = document.createElement("iframe");
      iframe.src = "./index3.html";
      iframe.id = "ex3";
      body.appendChild(iframe);
    };
    body.appendChild(button);

    const button2 = document.createElement("button");
    button2.innerText = "卸载ex3";
    button2.onclick = () => {
      if (window.self.length === 0) return;
      const ex3 = document.getElementById("ex3");
      body.removeChild(ex3);
    };
    body.appendChild(button2);
  </script>
</html>
