(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{398:function(t,s,a){"use strict";a.r(s);var n=a(54),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"快速上手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速上手"}},[t._v("#")]),t._v(" 快速上手")]),t._v(" "),a("p",[t._v("简单介绍安装和使用方法")]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("p",[t._v("使用以下方法安装")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("yarn add u"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mq  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//推荐")]),t._v("\n")])])]),a("p",[t._v("or")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("npm install u"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mq\n")])])]),a("h2",{attrs:{id:"基础使用方法介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础使用方法介绍"}},[t._v("#")]),t._v(" 基础使用方法介绍")]),t._v(" "),a("p",[t._v("创建一个实例")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main.js 文件")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" UNodeMQ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"u-node-mq"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//写入一个交换机名称，选填队列名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" unmq "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UNodeMQ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" exchangeName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EXCHANGE_NAME"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" queueNameList"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"QUEUE1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"QUEUE2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//配置路由或者路由中继器，分配消息到指定的队列")]),t._v("\nunmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("routes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"QUEUE1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"QUEUE2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" unmq\n")])])]),a("p",[t._v("发送消息")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// send.js 文件")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" unmq "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"main.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//发送消息的方法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  unmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("emit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"消息1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"消息2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("消费消息")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//consume.js 文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" unmq "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"main.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建消费者绑定到队列")]),t._v("\nunmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"QUEUE1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("news"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("consume")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("news")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("消息内容：")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("news"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"unodemq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unodemq"}},[t._v("#")]),t._v(" UNodeMQ")]),t._v(" "),a("p",[t._v("创建实例，同时需要指定 "),a("RouterLink",{attrs:{to:"/guide/basic-components.html#交换机"}},[t._v("routes")]),t._v(" 或者 "),a("RouterLink",{attrs:{to:"/guide/basic-components.html#交换机"}},[t._v("repeater")])],1),t._v(" "),a("p",[a("code",[t._v('new UNodeMQ<D>({ exchangeName: "EXCHANGE_NAME", queueNameList: ["QUEUE1", "QUEUE2"] })')])]),t._v(" "),a("p",[t._v("也可以手动创建队列，设置队列属性，可配置是否需要消息确认，和失败后重新消费次数")]),t._v(" "),a("p",[a("code",[t._v('new Queue({name:"QUEUE1",ask:true})')])]),t._v(" "),a("p",[t._v("ts 可指定消息数据类型，下面消息数据类型用 D 表示；")]),t._v(" "),a("h2",{attrs:{id:"emit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#emit"}},[t._v("#")]),t._v(" emit")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("参数")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("{D} news")])]),t._v(" "),a("li",[a("code",[t._v("{D} news")])]),t._v(" "),a("li",[a("code",[t._v("... {D} news")])])])]),t._v(" "),a("li",[a("p",[t._v("返回值")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("this")])])])]),t._v(" "),a("li",[a("p",[t._v("用法")])])]),t._v(" "),a("p",[t._v("发送消息给队列，支持同时发送多条消息")]),t._v(" "),a("h2",{attrs:{id:"on"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#on"}},[t._v("#")]),t._v(" on")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("参数")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("{string} queueName")])]),t._v(" "),a("li",[a("code",[t._v("{function} consume")])]),t._v(" "),a("li",[a("code",[t._v("{any} payload")])])])]),t._v(" "),a("li",[a("p",[t._v("返回值")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("{function} off")])])])]),t._v(" "),a("li",[a("p",[t._v("用法")])])]),t._v(" "),a("p",[t._v("指定消费者订阅的队列，传入消费方法和固定参数载体；消息内容和 next 方法以及载体会传给消费方法（如果需要消息确认或者存在载体的情况下）")]),t._v(" "),a("p",[t._v("也可在订阅队列后使用链式调用立即移除消费者")]),t._v(" "),a("h2",{attrs:{id:"off"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#off"}},[t._v("#")]),t._v(" off")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("参数")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("{string} queueName")])]),t._v(" "),a("li",[a("code",[t._v("{function} consume")])])])]),t._v(" "),a("li",[a("p",[t._v("返回值")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("this")])])])]),t._v(" "),a("li",[a("p",[t._v("用法")])])]),t._v(" "),a("p",[t._v("移除指定队列上的消费者，如果消费者不存在，会打印日志，正常返回this")]),t._v(" "),a("h2",{attrs:{id:"once"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#once"}},[t._v("#")]),t._v(" once")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("参数")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("{string} queueName")])]),t._v(" "),a("li",[a("code",[t._v("{function} consume")])]),t._v(" "),a("li",[a("code",[t._v("{any} payload")])])])]),t._v(" "),a("li",[a("p",[t._v("返回值")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("this")])])])]),t._v(" "),a("li",[a("p",[t._v("用法")])])]),t._v(" "),a("p",[t._v("与on方法类似，不同的是消费一条消息后将自动移除消费者")]),t._v(" "),a("h2",{attrs:{id:"on-和-once-方法的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#on-和-once-方法的区别"}},[t._v("#")]),t._v(" "),a("code",[t._v("on()()")]),t._v(" 和 "),a("code",[t._v("once()")]),t._v(" 方法的区别")]),t._v(" "),a("p",[a("code",[t._v("on()()")])]),t._v(" "),a("p",[t._v("立即消费指定队列中的所有消息，不管队列中有没有消息，消费结束就会移除消费者；")]),t._v(" "),a("p",[a("code",[t._v("once()")])]),t._v(" "),a("p",[t._v("等待指定队列中至少有一条消息才开始消费，并且只消费一条消息，有且仅当消费了一条消息后消费者才被移除；")])])}),[],!1,null,null,null);s.default=e.exports}}]);