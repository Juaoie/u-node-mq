{
  "version": 3,
  "sources": ["../src/index.ts", "../src/internal/Logs.ts", "../src/core/ExchangeCollectionHandle.ts", "../src/core/QueueCollectionHandle.ts", "../src/core/Collection.ts", "../src/core/UNodeMQ.ts", "../src/utils/tools.ts", "../src/internal/Exchange.ts", "../src/internal/News.ts", "../src/internal/Consumer.ts", "../src/internal/Queue.ts", "../src/plugins/iframe/loader.ts", "../src/plugins/iframe/index.ts", "../src/operators/map.ts", "../src/operators/debounceTime.ts", "../src/operators/throttleTime.ts", "../src/operators/task.ts", "../src/operators/newsTime.ts", "../src/operators/of.ts", "../src/operators/interval.ts"],
  "sourcesContent": ["/**\r\n * \u4E3B\u5305\r\n */\r\nimport UNodeMQ, { createUnmq, createQuickUnmq, QuickUNodeMQ, PluginInstallFunction } from \"./core/UNodeMQ\";\r\nexport default UNodeMQ;\r\nexport { createUnmq, createQuickUnmq, QuickUNodeMQ, PluginInstallFunction };\r\n\r\n/**\r\n * \u7EC4\u4EF6\r\n */\r\nimport Exchange from \"./internal/Exchange\";\r\nimport Queue, { ConsumMode, Operator } from \"./internal/Queue\";\r\nimport Consumer from \"./internal/Consumer\";\r\nimport News from \"./internal/News\";\r\nimport Logs from \"./internal/Logs\";\r\nexport { Exchange, Queue, Consumer, News, Logs };\r\n\r\nexport { ConsumMode, Operator };\r\n\r\n/**\r\n * plugins\r\n */\r\nimport IframePlugin from \"./plugins/iframe/index\";\r\nexport { IframePlugin };\r\n\r\n/**\r\n * operators\r\n */\r\nexport { map } from \"./operators/map\";\r\nexport { debounceTime } from \"./operators/debounceTime\";\r\nexport { throttleTime } from \"./operators/throttleTime\";\r\nexport { task } from \"./operators/task\";\r\nexport { newsTime } from \"./operators/newsTime\";\r\nexport { of } from \"./operators/of\";\r\nexport { interval } from \"./operators/interval\";\r\n/**\r\n * \u8F6C\u6362\r\n */\r\nexport const extend = Object.assign;\r\nexport const objectToString = Object.prototype.toString;\r\nexport const toTypeString = (value: unknown): string => objectToString.call(value);\r\n\r\n/**\r\n * \u7C7B\u578B\u5224\u65AD\r\n */\r\nexport const isArray = Array.isArray;\r\nexport const isMap = (val: unknown): val is Map<any, any> => toTypeString(val) === \"[object Map]\";\r\nexport const isSet = (val: unknown): val is Set<any> => toTypeString(val) === \"[object Set]\";\r\nexport const isDate = (val: unknown): val is Date => val instanceof Date;\r\nexport const isFunction = (val: unknown): val is Function => typeof val === \"function\";\r\nexport const isString = (val: unknown): val is string => typeof val === \"string\";\r\nexport const isNumber = (val: unknown): val is number => typeof val === \"number\";\r\nexport const isBoolean = (val: unknown): val is boolean => typeof val === \"boolean\";\r\nexport const isSymbol = (val: unknown): val is symbol => typeof val === \"symbol\";\r\nexport const isObject = (val: unknown): val is Record<any, any> => val !== null && typeof val === \"object\";\r\nexport const isPromise = <T = any>(val: unknown): val is Promise<T> => {\r\n  return isObject(val) && isFunction(val.then) && isFunction(val.catch);\r\n};\r\n", "export default class Logs {\r\n  static unmq = null; //new UNodeMQ({ exchangeName: \"logs\", queueName: [\"error\"] });\r\n  static error(message: any) {\r\n    // this.unmq.emit()\r\n    console.error(message);\r\n  }\r\n  static log(message: any) {\r\n    console.log(message);\r\n  }\r\n}\r\n", "import { Exchange } from \"../index\";\r\nimport Logs from \"../internal/Logs\";\r\n\r\nexport default class ExchangeCollectionHandle {\r\n  private exchangeCollection = new Map<string, Exchange<any>>();\r\n  has(exchangeName: string) {\r\n    if (this.exchangeCollection.has(exchangeName)) return true;\r\n    else {\r\n      Logs.error(`${exchangeName} not find`);\r\n      return false;\r\n    }\r\n  }\r\n  setExchangeCollection(exchangeCollection: Record<string, Exchange<unknown>>) {\r\n    this.exchangeCollection = new Map(Object.entries(exchangeCollection));\r\n  }\r\n  getExchange(exchangeName: string): Exchange<unknown> | null {\r\n    const exchange = this.exchangeCollection.get(exchangeName);\r\n    if (exchange === undefined) {\r\n      Logs.error(`${exchangeName} not find`);\r\n      return null;\r\n    }\r\n    return exchange;\r\n  }\r\n  getExchangeList() {\r\n    return [...this.exchangeCollection.values()];\r\n  }\r\n  /**\r\n   * \u6839\u636E\u4EA4\u6362\u673A\u540D\u79F0\u83B7\u53D6\u961F\u5217\u540D\u79F0\u5217\u8868\r\n   * @param exchangeName\r\n   * @param content\r\n   * @returns\r\n   */\r\n  async getQueueNameList(exchangeName: string, content: unknown) {\r\n    const exchagne = this.getExchange(exchangeName);\r\n    if (exchagne === null) return [];\r\n    return exchagne.getQueueNameList(content);\r\n  }\r\n}\r\n", "import { Logs, Queue, News, isFunction } from \"../index\";\r\nimport { Consume } from \"../internal/Consumer\";\r\n\r\n/**\r\n * \u961F\u5217\u96C6\u5408\r\n */\r\nexport default class QueueCollectionHandle {\r\n  private queueCollection = new Map<string, Queue<any>>();\r\n  has(queueName: string) {\r\n    if (this.queueCollection.has(queueName)) return true;\r\n    else {\r\n      Logs.error(`${queueName} not find`);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  setQueueCollection(queueCollection: Record<string, Queue<unknown>>) {\r\n    this.queueCollection = new Map(Object.entries(queueCollection));\r\n  }\r\n  getQueue(queueName: string): Queue<unknown> | null {\r\n    const queue = this.queueCollection.get(queueName);\r\n    if (queue === undefined) {\r\n      Logs.error(`${queueName} not find`);\r\n      return null;\r\n    }\r\n    return queue;\r\n  }\r\n  getQueueList() {\r\n    return [...this.queueCollection.values()];\r\n  }\r\n  addQueue(queue: Queue<unknown>) {\r\n    if (queue.name === undefined) throw \"queue.name is undefined\";\r\n    this.queueCollection.set(queue.name, queue);\r\n  }\r\n  pushNewsToQueue(queueName: string, news: News<unknown>) {\r\n    this.getQueue(queueName)?.pushNews(news);\r\n  }\r\n  /**\r\n   * \u6DFB\u52A0\u4E00\u4E2A\u6D88\u606F\u5185\u5BB9\u5230\u961F\u5217\r\n   * @param queueName\r\n   * @param content\r\n   * @returns\r\n   */\r\n  pushContentToQueue(queueName: string, content: unknown) {\r\n    this.getQueue(queueName)?.pushContent(content);\r\n  }\r\n  /**\r\n   * \u8BA2\u9605\u961F\u5217\r\n   * @param queueName\r\n   * @param consume\r\n   * @param payload\r\n   * @returns\r\n   */\r\n  subscribeQueue(queueName: string, consume: Consume<unknown>, payload?: any) {\r\n    this.getQueue(queueName)?.pushConsume(consume, payload);\r\n  }\r\n  /**\r\n   * \u53D6\u6D88\u8BA2\u9605\u961F\u5217\r\n   * @param queueName\r\n   * @param consume\r\n   */\r\n  unsubscribeQueue(queueName: string, consume?: Consume<unknown>): boolean {\r\n    if (!this.has(queueName)) return false;\r\n    if (isFunction(consume)) {\r\n      return !!this.getQueue(queueName)?.removeConsumer(consume);\r\n    } else {\r\n      return !!this.getQueue(queueName)?.removeAllConsumer();\r\n    }\r\n  }\r\n}\r\n", "import { Exchange, Queue, News } from \"../index\";\r\nimport { Consume } from \"../internal/Consumer\";\r\nimport ExchangeCollectionHandle from \"./ExchangeCollectionHandle\";\r\nimport QueueCollectionHandle from \"./QueueCollectionHandle\";\r\nexport default class Collection<\r\n  ExchangeCollection extends Record<string, Exchange<unknown>>,\r\n  QueueCollection extends Record<string, Queue<unknown>>\r\n> {\r\n  private readonly exchangeCollectionHandle = new ExchangeCollectionHandle();\r\n  private readonly queueCollectionHandle = new QueueCollectionHandle();\r\n\r\n  constructor(exchangeCollection: ExchangeCollection, queueCollection: QueueCollection) {\r\n    for (const name in exchangeCollection) {\r\n      exchangeCollection[name].name = name;\r\n    }\r\n    for (const name in queueCollection) {\r\n      queueCollection[name].name = name;\r\n    }\r\n    this.exchangeCollectionHandle.setExchangeCollection(exchangeCollection);\r\n    this.queueCollectionHandle.setQueueCollection(queueCollection);\r\n  }\r\n  getExchange<E extends keyof ExchangeCollection & string>(exchangeName: E) {\r\n    return this.exchangeCollectionHandle.getExchange(exchangeName);\r\n  }\r\n  getExchangeList() {\r\n    return this.exchangeCollectionHandle.getExchangeList();\r\n  }\r\n  getQueue<Q extends keyof QueueCollection & string>(queueName: Q) {\r\n    return this.queueCollectionHandle.getQueue(queueName);\r\n  }\r\n  getQueueList() {\r\n    return this.queueCollectionHandle.getQueueList();\r\n  }\r\n  addQueue(queue: Queue<unknown>) {\r\n    this.queueCollectionHandle.addQueue(queue);\r\n  }\r\n  /**\r\n   * \u53D1\u9001\u6D88\u606F\u5230\u4EA4\u6362\u673A\r\n   * @param exchangeName\r\n   * @param news\r\n   */\r\n  pushNewsListToExchange<E extends keyof ExchangeCollection & string>(exchangeName: E, ...news: News<unknown>[]) {\r\n    for (const newsItem of news) {\r\n      //\u5206\u522B\u53D1\u9001\u6BCF\u4E00\u6761\u6D88\u606F\r\n      this.exchangeCollectionHandle.getQueueNameList(exchangeName, newsItem.content).then((queueNameList) => {\r\n        for (const queueName in queueNameList) {\r\n          this.pushNewsListToQueue(queueName, newsItem);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \u53D1\u9001\u6D88\u606F\u5230\u961F\u5217\r\n   * @param queueName\r\n   * @param news\r\n   */\r\n  pushNewsListToQueue<Q extends keyof QueueCollection & string>(queueName: Q, ...news: News<unknown>[]) {\r\n    for (const newsItem of news) {\r\n      //\u5206\u522B\u53D1\u9001\u6BCF\u4E00\u6761\u6D88\u606F\r\n      this.queueCollectionHandle.pushNewsToQueue(queueName, newsItem);\r\n    }\r\n  }\r\n  /**\r\n   * \u53D1\u9001\u6D88\u606F\u5185\u5BB9\u5230\u4EA4\u6362\u673A\r\n   * @param exchangeName\r\n   * @param contentList\r\n   */\r\n  pushContentListToExchange<E extends keyof ExchangeCollection & string>(exchangeName: E, ...contentList: unknown[]) {\r\n    for (const content of contentList) {\r\n      //\u5206\u522B\u53D1\u9001\u6BCF\u4E00\u6761\u6D88\u606F\r\n      this.exchangeCollectionHandle.getQueueNameList(exchangeName, content).then((queueNameList) => {\r\n        for (const queueName of queueNameList) {\r\n          this.pushContentListToQueue(queueName, content);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   *  \u53D1\u9001\u6D88\u606F\u5185\u5BB9\u5230\u961F\u5217\r\n   * @param queueName\r\n   * @param contentList\r\n   */\r\n  pushContentListToQueue<Q extends keyof QueueCollection & string>(queueName: Q, ...contentList: unknown[]) {\r\n    for (const content of contentList) {\r\n      //\u5206\u522B\u53D1\u9001\u6BCF\u4E00\u6761\u6D88\u606F\r\n      this.queueCollectionHandle.pushContentToQueue(queueName, content);\r\n    }\r\n  }\r\n  /**\r\n   * \u8BA2\u9605\u961F\u5217\r\n   * @param queueName\r\n   * @param consume\r\n   * @param payload\r\n   */\r\n  subscribeQueue<Q extends keyof QueueCollection & string>(queueName: Q, consume: Consume<any>, payload?: any) {\r\n    this.queueCollectionHandle.subscribeQueue(queueName, consume, payload);\r\n  }\r\n  /**\r\n   * \u53D6\u6D88\u8BA2\u9605\u961F\u5217\r\n   */\r\n  unsubscribeQueue<Q extends keyof QueueCollection & string>(queueName: Q, consume?: Consume<any>) {\r\n    this.queueCollectionHandle.unsubscribeQueue(queueName, consume);\r\n  }\r\n}\r\n", "import { Exchange, Queue, isFunction } from \"../index\";\r\nimport { Consume, Next } from \"../internal/Consumer\";\r\n\r\n/**\r\n * \u83B7\u53D6\u961F\u5217\u540D\u79F0\u8FD4\u56DE\u7684promise\u5BFC\u81F4\u6D88\u8D39\u4E8B\u4EF6\u52A0\u5165\u5FAE\u4EFB\u52A1\u961F\u5217\u5EF6\u8FDF\u6D88\u8D39\uFF08ios\u5C5E\u4E8E\u52A0\u5165\u666E\u901A\u4EFB\u52A1\u961F\u5217\uFF09\r\n * \u8FD9\u6837\u540C\u65F6\u4FDD\u8BC1\u4E86\u5728\u89C2\u5BDF\u8005\u6A21\u5F0F\u4E2D\u6570\u636E\u80FD\u51C6\u786E\u5206\u53D1\r\n */\r\n\r\nimport Collection from \"./Collection\";\r\n\r\nexport type ReturnPanShapeExchange<T> = T extends Exchange<infer U> ? U : never;\r\nexport type ReturnPanShapeQueue<T> = T extends Queue<infer U> ? U : never;\r\n\r\nexport type PluginInstallFunction = <\r\n  ExchangeCollection extends Record<string, Exchange<any>>,\r\n  QueueCollection extends Record<string, Queue<any>>\r\n>(\r\n  unmq: UNodeMQ<ExchangeCollection, QueueCollection>,\r\n  ...options: any[]\r\n) => void;\r\nexport type Plugin =\r\n  | (PluginInstallFunction & { install?: PluginInstallFunction })\r\n  | {\r\n      install: PluginInstallFunction;\r\n    };\r\nexport function createUnmq<\r\n  ExchangeCollection extends Record<string, Exchange<any>>,\r\n  QueueCollection extends Record<string, Queue<any>>\r\n>(exchangeCollection: ExchangeCollection, queueCollection: QueueCollection) {\r\n  return new UNodeMQ(exchangeCollection, queueCollection);\r\n}\r\n//TODO:\u589E\u52A0\u53EF\u4EE5\u4F7F\u7528\u6570\u7EC4\u7684\u65B9\u5F0F\u521B\u5EFAExchange\u548CQueue\r\n/**\r\n * UNodeMQ \u53D1\u5E03\u8BA2\u9605\u6A21\u578B\r\n */\r\nexport default class UNodeMQ<\r\n  ExchangeCollection extends Record<string, Exchange<any>>,\r\n  QueueCollection extends Record<string, Queue<any>>\r\n> extends Collection<ExchangeCollection, QueueCollection> {\r\n  constructor(exchangeCollection: ExchangeCollection, queueCollection: QueueCollection) {\r\n    super(exchangeCollection, queueCollection);\r\n  }\r\n  private readonly installedPlugins: Set<Plugin> = new Set();\r\n  use(plugin: Plugin, ...options: any[]) {\r\n    if (this.installedPlugins.has(plugin)) {\r\n      console.log(`Plugin has already been applied to target unmq.`);\r\n    } else if (plugin && isFunction(plugin.install)) {\r\n      this.installedPlugins.add(plugin);\r\n      plugin.install<ExchangeCollection, QueueCollection>(this, ...options);\r\n    } else if (isFunction(plugin)) {\r\n      this.installedPlugins.add(plugin);\r\n      plugin<ExchangeCollection, QueueCollection>(this, ...options);\r\n    }\r\n    return this;\r\n  }\r\n  /**\r\n   * \u53D1\u5C04\u6570\u636E\u5230\u4EA4\u6362\u673A\r\n   * @param contentList \u6D88\u606F\u4F53\u5217\u8868\r\n   * @returns\r\n   */\r\n  emit<E extends keyof ExchangeCollection & string>(\r\n    exchangeName: E,\r\n    ...contentList: ReturnPanShapeExchange<ExchangeCollection[E]>[]\r\n  ) {\r\n    super.pushContentListToExchange(exchangeName, ...contentList);\r\n    return this;\r\n  }\r\n  /**\r\n   * \u53D1\u5C04\u6570\u636E\u5230\u961F\u5217\r\n   * @param queueName\r\n   * @param contentList\r\n   * @returns\r\n   */\r\n  emitToQueue<Q extends keyof QueueCollection & string>(\r\n    queueName: Q,\r\n    ...contentList: ReturnPanShapeQueue<QueueCollection[Q]>[]\r\n  ) {\r\n    super.pushContentListToQueue(queueName, ...contentList);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *  \u8BA2\u9605\u961F\u5217\u6D88\u606F\r\n   * \u961F\u5217\u540D\u79F0\u4E3Anull \u5219\u8BA2\u9605\u6240\u6709\u961F\u5217\r\n   * \u6D88\u8D39\u65B9\u6CD5\r\n   * @param queueName \u961F\u5217\u540D\u79F0\r\n   * @param consume \u6D88\u8D39\u65B9\u6CD5\r\n   * @param payload \u56FA\u5B9A\u53C2\u6570\uFF0C\u6709\u6548\u8F7D\u8377\uFF0C\u5728\u6BCF\u6B21\u6D88\u8D39\u7684\u65F6\u5019\u90FD\u4F20\u7ED9\u6D88\u8D39\u8005\r\n   * @returns\r\n   */\r\n  on<Q extends keyof QueueCollection & string>(\r\n    queueName: Q,\r\n    consume: Consume<ReturnPanShapeQueue<QueueCollection[Q]>>,\r\n    payload?: any\r\n  ) {\r\n    super.subscribeQueue(queueName, consume, payload);\r\n    return () => this.off(queueName, consume);\r\n  }\r\n\r\n  /**\r\n   * \u79FB\u9664\u6D88\u8D39\u8005\r\n   * @param queueName\r\n   * @param consume\r\n   */\r\n  off<Q extends keyof QueueCollection>(queueName: Q, consume: Consume<ReturnPanShapeQueue<QueueCollection[Q]>>): this;\r\n  off<Q extends keyof QueueCollection>(queueName: Q): this;\r\n  off<Q extends keyof QueueCollection & string>(x: Q, y?: Consume<ReturnPanShapeQueue<QueueCollection[Q]>>): this {\r\n    super.unsubscribeQueue(x, y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * \u8BA2\u9605\u4E00\u6761\u6D88\u606F\r\n   * \u4E0D\u4F20\u5165\u6D88\u8D39\u65B9\u6CD5\uFF0C\u5219\u8FD4\u56DEPromise<D>\r\n   * @param queueName\r\n   * @param consume\r\n   * @param payload\r\n   * @returns\r\n   */\r\n  once<Q extends keyof QueueCollection & string>(\r\n    queueName: Q,\r\n    consume: Consume<ReturnPanShapeQueue<QueueCollection[Q]>>,\r\n    payload?: any\r\n  ): this;\r\n  once<Q extends keyof QueueCollection & string>(queueName: Q): Promise<ReturnPanShapeQueue<QueueCollection[Q]>>;\r\n  once<Q extends keyof QueueCollection & string>(\r\n    queueName: Q,\r\n    consume?: Consume<ReturnPanShapeQueue<QueueCollection[Q]>>,\r\n    payload?: any\r\n  ) {\r\n    if (!isFunction(consume)) {\r\n      return new Promise((resolve) => {\r\n        const consumeProxy = (content: any) => {\r\n          this.off(queueName, consumeProxy);\r\n          resolve(content);\r\n          return true;\r\n        };\r\n        this.on(queueName, consumeProxy, payload);\r\n      });\r\n    } else {\r\n      const consumeProxy = (content: any, next?: Next, payload?: any) => {\r\n        this.off(queueName, consumeProxy);\r\n        return consume(content, next, payload);\r\n      };\r\n      this.on(queueName, consumeProxy, payload);\r\n      return this;\r\n    }\r\n  }\r\n}\r\nexport function createQuickUnmq<D, QueueCollection extends Record<string, Queue<D>>>(\r\n  exchange: Exchange<D>,\r\n  queueCollection: QueueCollection\r\n) {\r\n  return new QuickUNodeMQ(exchange, queueCollection);\r\n}\r\n/**\r\n * quick start unmq\r\n * single type unmq\r\n */\r\nexport class QuickUNodeMQ<D, QueueCollection extends Record<string, Queue<D>>> {\r\n  constructor(private readonly exchange: Exchange<D>, private readonly queueCollection: QueueCollection) {\r\n    for (const name in queueCollection) {\r\n      queueCollection[name].name = name;\r\n    }\r\n  }\r\n  /**\r\n   * \u53D1\u5C04\u6570\u636E\u5230\u4EA4\u6362\u673A\r\n   * @param contentList \u6D88\u606F\u4F53\u5217\u8868\r\n   * @returns\r\n   */\r\n  emit(...contentList: D[]) {\r\n    for (const content of contentList) {\r\n      this.exchange.getQueueNameList(content).then((queueNameList: string[]) => {\r\n        for (const queueName of queueNameList) {\r\n          if (this.queueCollection[queueName] === undefined) continue;\r\n          this.queueCollection[queueName].pushContent(content);\r\n        }\r\n      });\r\n    }\r\n    return this;\r\n  }\r\n  /**\r\n   * \u53D1\u5C04\u6570\u636E\u5230\u961F\u5217\r\n   * @param queueName\r\n   * @param contentList\r\n   * @returns\r\n   */\r\n  emitToQueue<Q extends keyof QueueCollection & string>(queueName: Q, ...contentList: D[]) {\r\n    for (const content of contentList) {\r\n      this.queueCollection[queueName].pushContent(content);\r\n    }\r\n    return this;\r\n  }\r\n  /**\r\n   *  \u8BA2\u9605\u961F\u5217\u6D88\u606F\r\n   * \u961F\u5217\u540D\u79F0\u4E3Anull \u5219\u8BA2\u9605\u6240\u6709\u961F\u5217\r\n   * \u6D88\u8D39\u65B9\u6CD5\r\n   * @param queueName \u961F\u5217\u540D\u79F0\r\n   * @param consume \u6D88\u8D39\u65B9\u6CD5\r\n   * @param payload \u56FA\u5B9A\u53C2\u6570\uFF0C\u6709\u6548\u8F7D\u8377\uFF0C\u5728\u6BCF\u6B21\u6D88\u8D39\u7684\u65F6\u5019\u90FD\u4F20\u7ED9\u6D88\u8D39\u8005\r\n   * @returns\r\n   */\r\n  on<Q extends keyof QueueCollection & string>(queueName: Q, consume: Consume<D>, payload?: any) {\r\n    this.queueCollection[queueName].pushConsume(consume, payload);\r\n    return () => this.off(queueName, consume);\r\n  }\r\n\r\n  /**\r\n   * \u79FB\u9664\u6D88\u8D39\u8005\r\n   * @param queueName\r\n   * @param consume\r\n   */\r\n  off<Q extends keyof QueueCollection>(queueName: Q, consume: Consume<D>): this;\r\n  off<Q extends keyof QueueCollection>(queueName: Q): this;\r\n  off<Q extends keyof QueueCollection & string>(x: Q, y?: Consume<D>): this {\r\n    if (isFunction(y)) {\r\n      this.queueCollection[x].removeConsumer(y);\r\n    } else this.queueCollection[x].removeAllConsumer();\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * \u8BA2\u9605\u4E00\u6761\u6D88\u606F\r\n   * @param queueName\r\n   * @param consume\r\n   * @param payload\r\n   * @returns\r\n   */\r\n  once<Q extends keyof QueueCollection & string>(queueName: Q, consume: Consume<D>, payload?: any): this;\r\n  once<Q extends keyof QueueCollection & string>(queueName: Q): Promise<D>;\r\n  once<Q extends keyof QueueCollection & string>(queueName: Q, consume?: Consume<D>, payload?: any) {\r\n    if (!isFunction(consume)) {\r\n      return new Promise((resolve) => {\r\n        const consumeProxy = (content: any) => {\r\n          this.off(queueName, consumeProxy);\r\n          resolve(content);\r\n          return true;\r\n        };\r\n        this.on(queueName, consumeProxy, payload);\r\n      });\r\n    } else {\r\n      const consumeProxy = (content: any, next?: Next, payload?: any) => {\r\n        this.off(queueName, consumeProxy);\r\n        return consume(content, next, payload);\r\n      };\r\n      this.on(queueName, consumeProxy, payload);\r\n      return this;\r\n    }\r\n  }\r\n}\r\n", "/**\r\n * \u5DE5\u5177\u7C7B\r\n */\r\nexport default class Tools {\r\n  /**\r\n   * \u83B7\u53D6\u968F\u673A\u6570\r\n   * @returns\r\n   */\r\n  static random(): string {\r\n    return String(Math.round(Math.random() * 10000000000));\r\n  }\r\n  static promiseSetTimeout = (time = 0) => new Promise((resolve) => setTimeout(resolve, time));\r\n\r\n  /**\r\n   * \u83B7\u53D6\u683C\u5F0F\u5316\u65F6\u95F4\r\n   * @returns\r\n   */\r\n  static getTimeFormat(time?: string | number): string {\r\n    let now = null;\r\n    if (time) now = new Date(time);\r\n    else now = new Date();\r\n\r\n    const year = now.getFullYear(); //\u5E74\r\n    const month = now.getMonth() + 1; //\u6708\r\n    const day = now.getDate(); //\u65E5\r\n\r\n    const hh = now.getHours(); //\u65F6\r\n    const mm = now.getMinutes(); //\u5206\r\n\r\n    let clock = year + \"-\";\r\n\r\n    if (month < 10) clock += \"0\";\r\n    clock += month + \"-\";\r\n\r\n    if (day < 10) clock += \"0\";\r\n    clock += day + \" \";\r\n\r\n    if (hh < 10) clock += \"0\";\r\n    clock += hh + \":\";\r\n    if (mm < 10) clock += \"0\";\r\n    clock += mm;\r\n    return clock;\r\n  }\r\n\r\n  /**\r\n   *   //\u5B57\u7B26\u7F16\u7801\u6570\u503C\u5BF9\u5E94\u7684\u5B58\u50A8\u957F\u5EA6\uFF1A\r\n  //UCS-2\u7F16\u7801(16\u8FDB\u5236) UTF-8 \u5B57\u8282\u6D41(\u4E8C\u8FDB\u5236)\r\n  //0000 - 007F       0xxxxxxx \uFF081\u5B57\u8282\uFF09\r\n  //0080 - 07FF       110xxxxx 10xxxxxx \uFF082\u5B57\u8282\uFF09\r\n  //0800 - FFFF       1110xxxx 10xxxxxx 10xxxxxx \uFF083\u5B57\u8282\uFF09\r\n   * @param str \r\n   * @returns \r\n   */\r\n  static memorySize = (str: string): string => {\r\n    let totalLength = 0;\r\n    let charCode;\r\n    for (let i = 0; i < str.length; i++) {\r\n      charCode = str.charCodeAt(i);\r\n      if (charCode < 0x007f) {\r\n        totalLength++;\r\n      } else if (0x0080 <= charCode && charCode <= 0x07ff) {\r\n        totalLength += 2;\r\n      } else if (0x0800 <= charCode && charCode <= 0xffff) {\r\n        totalLength += 3;\r\n      } else {\r\n        totalLength += 4;\r\n      }\r\n    }\r\n    if (totalLength >= 1024 * 1024) return (totalLength / (1024 * 1024)).toFixed(2) + \"MB\";\r\n    if (totalLength >= 1024 && totalLength < 1024 * 1024) return (totalLength / 1024).toFixed(2) + \"KB\";\r\n    else return totalLength + \"B\";\r\n  };\r\n}\r\n", "import Tools from \"../utils/tools\";\r\nimport Logs from \"./Logs\";\r\n/**\r\n * \u4E2D\u7EE7\u5668\u7C7B\u578B\r\n */\r\ntype Repeater<D> = (content: D) => Promise<string[]> | string[];\r\n\r\nexport type Option<D> = {\r\n  routes?: string[];\r\n  repeater?: Repeater<D>;\r\n  name?: string;\r\n  [k: string]: any;\r\n};\r\n/**\r\n * \u4EA4\u6362\u673A\r\n */\r\nexport default class Exchange<D> {\r\n  [k: string]: any;\r\n  name?: string;\r\n  /**\r\n   * id\r\n   */\r\n  private readonly id: string = Tools.random();\r\n  getId() {\r\n    return this.id;\r\n  }\r\n  /**\r\n   * \u9759\u6001\u8DEF\u7531\r\n   */\r\n  private routes: string[] = [];\r\n  getRoutes() {\r\n    return this.routes;\r\n  }\r\n  pushRoutes(routes: string[]) {\r\n    this.routes = Array.from(new Set(this.routes.concat(routes)));\r\n  }\r\n  setRoutes(routes: string[]) {\r\n    this.routes = routes;\r\n  }\r\n  /**\r\n   * \u52A8\u6001\u8DEF\u7531\uFF08\u4E2D\u7EE7\u5668\uFF09\r\n   */\r\n  private repeater: Repeater<D> = () => this.getRoutes();\r\n  getRepeater() {\r\n    return this.repeater;\r\n  }\r\n  setRepeater(repeater: Repeater<D>) {\r\n    this.repeater = repeater;\r\n  }\r\n\r\n  constructor(option?: Option<D>) {\r\n    Object.assign(this, option);\r\n  }\r\n\r\n  /**\r\n   * \u5220\u9664routes\r\n   * @param routes\r\n   */\r\n  removeRoutes(routes?: string[]) {\r\n    if (routes === undefined) this.routes = [];\r\n    else this.routes = this.routes.filter((item) => routes.indexOf(item) !== -1);\r\n  }\r\n\r\n  /**\r\n   * \u83B7\u53D6\u961F\u5217\u540D\u79F0\u5217\u8868\r\n   * @param content\r\n   * @returns\r\n   */\r\n  async getQueueNameList(content: D): Promise<string[]> {\r\n    try {\r\n      //\u4E2D\u7EE7\u5668\u6A21\u5F0F\r\n      return await this.repeater(content);\r\n    } catch (error) {\r\n      Logs.error(`exchange function getstringList exception`);\r\n      return [];\r\n    }\r\n  }\r\n}\r\n", "import Tools from \"../utils/tools\";\r\n\r\nexport default class News<D> {\r\n  [k: string]: any;\r\n  /**\r\n   * id\r\n   */\r\n  private readonly id: string = Tools.random();\r\n  getId() {\r\n    return this.id;\r\n  }\r\n  /**\r\n   * \u6D88\u8D39\u8005\u521B\u5EFA\u65F6\u95F4\u6233\r\n   */\r\n  readonly createTime: number;\r\n  /**\r\n   * \u6D88\u606F\u5185\u5BB9\r\n   */\r\n  content: D;\r\n  /**\r\n   * \u5269\u4F59\u53EF\u91CD\u590D\u6D88\u8D39\u6B21\u6570\r\n   */\r\n  consumedTimes: number = -1;\r\n\r\n  constructor(content: D) {\r\n    this.createTime = new Date().getTime();\r\n    this.content = content;\r\n  }\r\n}\r\n", "import { isPromise } from \"../index\";\r\nimport Tools from \"../utils/tools\";\r\nimport Logs from \"./Logs\";\r\nimport News from \"./News\";\r\nexport type Next = (value?: boolean) => void;\r\n\r\nexport interface Consume<D> {\r\n  (content: D, next?: Next, payload?: any): Promise<any> | any;\r\n  (content: D, payload?: any): any;\r\n}\r\ntype ThenParameter<D> = (isOk: boolean) => void;\r\ninterface Payload<D> {\r\n  then: (res: ThenParameter<D>) => void;\r\n}\r\nexport default class Consumer<D> {\r\n  [k: string]: any;\r\n  /**\r\n   * id\r\n   */\r\n  private readonly id: string = Tools.random();\r\n  getId() {\r\n    return this.id;\r\n  }\r\n  /**\r\n   * \u6D88\u8D39\u8005\u521B\u5EFA\u65F6\u95F4\u6233\r\n   */\r\n  createTime: number;\r\n  /**\r\n   * \u6D88\u8D39\u65B9\u6CD5\r\n   */\r\n  consume: Consume<D>;\r\n  /**\r\n   * \u56FA\u5B9A\u53C2\u6570\r\n   */\r\n  payload?: any;\r\n  constructor(consume: Consume<D>, payload?: any) {\r\n    this.createTime = new Date().getTime();\r\n    this.consume = consume;\r\n    this.payload = payload;\r\n  }\r\n  /**\r\n   * \u6D88\u8D39\u6D88\u606F\r\n   * @param news\r\n   * @param ask\r\n   * @returns\r\n   */\r\n  consumption(news: News<D>, ask: boolean): Payload<D> {\r\n    const then = (thenParameter: ThenParameter<D>) => {\r\n      //\u4E0D\u52A0\u5165\u4EFB\u52A1\u961F\u5217\uFF0C\u4F1A\u5BFC\u81F4\u6D88\u8D39\u5931\u8D25\u7684\u6570\u636E\u91CD\u5199\u5230\u961F\u5217\u5931\u8D25\r\n      try {\r\n        if (!ask) {\r\n          //\u4E0D\u9700\u8981\u786E\u8BA4\u7684\u6D88\u8D39\u65B9\u6CD5\r\n          this.consume(news.content, this.payload);\r\n          return thenParameter(true);\r\n        }\r\n        //\u6784\u5EFA\u6D88\u606F\u786E\u8BA4\u7684\u65B9\u6CD5\r\n        let confirm: Next = (value = true) => thenParameter(value);\r\n        //\u9700\u8981\u786E\u8BA4\u7684\u6D88\u8D39\u65B9\u6CD5\r\n        const res = this.consume(news.content, confirm, this.payload);\r\n        //\u5982\u679C\u6D88\u606F\u9700\u8981\u786E\u8BA4\uFF0C\u4E14\u8FD4\u56DE\u7684\u5185\u5BB9\u4E3APromise\r\n        if (isPromise(res)) {\r\n          res\r\n            .then((onfulfilled) => {\r\n              thenParameter(Boolean(onfulfilled));\r\n            })\r\n            .catch(() => {\r\n              thenParameter(false);\r\n            });\r\n        } else if (typeof res === \"boolean\") {\r\n          confirm = () => {};\r\n          thenParameter(res);\r\n        }\r\n      } catch (error) {\r\n        Logs.error(\"Consumer consumption error\");\r\n        thenParameter(!ask);\r\n      }\r\n    };\r\n    return {\r\n      then,\r\n    };\r\n  }\r\n}\r\n", "import News from \"./News\";\r\nimport Consumer, { Consume } from \"./Consumer\";\r\nimport Logs from \"./Logs\";\r\nimport Tools from \"../utils/tools\";\r\ninterface Option<D> {\r\n  ask?: boolean;\r\n  rcn?: number;\r\n  mode?: ConsumMode;\r\n  name?: string;\r\n  async?: boolean;\r\n  maxTime?: number;\r\n  [k: string]: any;\r\n}\r\nexport enum ConsumMode {\r\n  \"Random\" = \"Random\",\r\n  \"All\" = \"All\",\r\n}\r\n//TODO:\u5C06\u7EC4\u4EF6\u5C01\u88C5\uFF0C\u6539\u6210\u6570\u636E\u54CD\u5E94\u5F0F\uFF0C\u907F\u514D\u9891\u7E41\u624B\u52A8\u64CD\u4F5C\u6570\u636E\u5BFC\u81F4bug\r\ninterface Component {\r\n  getId: () => string;\r\n}\r\nclass Components<Component> {\r\n  private component: Component[] = [];\r\n\r\n  constructor() {}\r\n}\r\n/**\r\n * \u4F1A\u5F02\u6B65\u6267\u884C\u7684\u8FD0\u7B97\u65B9\u6CD5\r\n * \u4E0D\u9700\u8981\u901A\u8FC7\u8FD4\u56DE\u503C\u63A7\u5236\u662F\u5426\u7EE7\u7EED\u6267\u884C\u6D41\u7A0B\r\n */\r\ninterface AsyncOperator<D> {\r\n  /**\r\n   * \u64CD\u4F5C\u6302\u8F7D\u6267\u884C\u65B9\u6CD5\r\n   * \u591A\u4E2A\u64CD\u4F5C\u7B26\u7684\u540C\u4E2A\u94A9\u5B50\u51FD\u6570\u4F1A\u540C\u65F6\u6267\u884C\uFF0C\u6240\u4EE5\u5E94\u8BE5\u8C28\u614E\u64CD\u4F5C\u6570\u636E\uFF0C\u907F\u514D\u4EA7\u751F\u5F02\u6B65\u64CD\u4F5C\u6570\u636E\u7684\u95EE\u9898\r\n   */\r\n  mounted?: (that: Queue<D>) => unknown;\r\n  /**\r\n   * \u6D88\u606F\u6210\u529F\u6DFB\u52A0\u5230\u961F\u5217\u4EE5\u540E\r\n   */\r\n  addedNews?: (news: News<D>) => unknown;\r\n\r\n  /**\r\n   * \u6D88\u8D39\u8005\u6210\u529F\u52A0\u5165\u5230\u961F\u5217\u4EE5\u540E\r\n   */\r\n  addedConsumer?: (consumer: Consumer<D>) => unknown;\r\n  /**\r\n   * \u6D88\u8D39\u8005\u6210\u529F\u88AB\u79FB\u9664\u4EE5\u540E\r\n   * consumerList \u88AB\u5220\u9664\u7684\u6D88\u8D39\u5217\u8868\r\n   */\r\n  removedConsumer?: (consumerList: Consumer<D>[]) => unknown;\r\n}\r\n\r\n/**\r\n * \u4F1A\u540C\u6B65\u7684\u6267\u884C\u7684\u8FD0\u7B97\u7B26\u65B9\u6CD5\r\n * \u6BCF\u4E2A\u8FD0\u7B97\u7B26\u65B9\u6CD5\u5217\u8868\u90FD\u4F1A\u540C\u6B65\u6267\u884C\uFF0C\u4E14\u4E00\u4E2A\u8FD4\u56DEfalse\uFF0C\u540E\u9762\u5219\u4E0D\u4F1A\u7EE7\u7EED\u6267\u884C\uFF0C\u7528\u4E8E\u63A7\u5236\u6D41\u7A0B\u662F\u5426\u7EE7\u7EED\r\n */\r\ninterface SyncOperator<D> {\r\n  /**\r\n   * \u5C06\u6D88\u606F\u6DFB\u52A0\u5230\u961F\u5217\u4E4B\u524D\r\n   * \u8FD4\u56DE\u7684boolean\u63A7\u5236\u6D88\u606F\u662F\u5426\u52A0\u5165\u961F\u5217\r\n   */\r\n  beforeAddNews?: (news: News<D>) => boolean | Promise<boolean>;\r\n  /**\r\n   * \u52A0\u5165\u6D88\u8D39\u8005\u4E4B\u524D\r\n   * \u8FD4\u56DE\u7684boolean\u63A7\u5236\u6D88\u8D39\u8005\u662F\u5426\u80FD\u52A0\u5165\u961F\u5217\r\n   */\r\n  // beforeAddConsumer?: (consumer: Consumer<D>) => boolean | Promise<boolean>;\r\n\r\n  /**\r\n   * \u6D88\u606F\u88AB\u5F39\u51FA\u6765\r\n   */\r\n  ejectedNews?: (news: News<D>) => boolean | Promise<boolean>;\r\n}\r\nfunction isAsyncOperator<D>(arg: keyof Operator<D>): arg is keyof AsyncOperator<D> {\r\n  return [\"mounted\", \"addedNews\", \"addedConsumer\", \"removedConsumer\"].indexOf(arg) !== -1;\r\n}\r\nfunction isSyncOperator<D>(arg: keyof Operator<D>): arg is keyof SyncOperator<D> {\r\n  return [\"beforeAddNews\", \"ejectedNews\"].indexOf(arg) !== -1;\r\n}\r\nexport type Operator<D> = AsyncOperator<D> & SyncOperator<D>;\r\n/**\r\n * \u961F\u5217\uFF0C\u7406\u8BBA\u4E0A\u4E00\u4E2A\u961F\u5217\u7684\u6570\u636E\u683C\u5F0F\u5E94\u8BE5\u5177\u6709\u4E00\u81F4\u6027\r\n *\r\n */\r\nexport default class Queue<D> {\r\n  [k: string]: any;\r\n  name?: string;\r\n  /**\r\n   * id\r\n   */\r\n  private readonly id: string = Tools.random();\r\n  getId() {\r\n    return this.id;\r\n  }\r\n  /**\r\n   * \u662F\u5426\u9700\u8981\u6D88\u606F\u786E\u8BA4\r\n   */\r\n  ask: boolean = false;\r\n  /**\r\n   * \u53EF\u91CD\u65B0\u6D88\u8D39\u6B21\u6570\uFF0C\u6D88\u8D39\u5931\u8D25\u4F1A\u91CD\u590D\u6D88\u8D39\r\n   */\r\n  rcn: number = 3;\r\n  /**\r\n   * \u6D88\u8D39\u6A21\u5F0F\r\n   * - Random \u968F\u673A\u62BD\u53D6\u6D88\u8D39\u8005\u6D88\u8D39\r\n   * - All \u4E00\u6761\u6D88\u606F\u6240\u6709\u6D88\u8D39\u8005\u90FD\u6D88\u8D39\r\n   */\r\n  mode: ConsumMode = ConsumMode.All;\r\n  /**\r\n   * \u9ED8\u8BA4\u662F\u540C\u6B65\u6D88\u8D39\r\n   * \u662F\u5426\u662F\u5F02\u6B65\u6D88\u8D39\uFF0C\u5982\u679C\u662F\u540C\u6B65\u6D88\u8D39\uFF0C\u5219\u4E00\u6761\u6D88\u606F\u6D88\u8D39\u5B8C\u6210\u6216\u8005\u6D88\u8D39\u5931\u8D25\u624D\u4F1A\u6D88\u8D39\u4E0B\u4E00\u6761\u6D88\u606F\r\n   * \u4E3A\u540C\u6B65\u6D88\u8D39\u65F6\uFF0Cmode\u4E3AALL\u5219\u9700\u8981\u6240\u6709\u6D88\u8D39\u8005\u90FD\u6D88\u8D39\u5B8C\u6216\u8005\u6D88\u8D39\u5931\u8D25\u624D\u80FD\u6D88\u8D39\u4E0B\u4E00\u6761\u6D88\u606F\r\n   */\r\n  async: boolean = false;\r\n  /**\r\n   * \u6D88\u8D39\u72B6\u6001\uFF0Ctrue\u4E3A\u6B63\u5728\u6D88\u8D39\uFF0Cfalse\u4E3A\u672A\u5728\u6D88\u8D39\r\n   * \u7528\u4E8E\u540C\u6B65\u6D88\u8D39\u5224\u65AD\u5F53\u524D\u7684\u6D88\u8D39\u72B6\u6001\r\n   */\r\n  private state: boolean = false;\r\n  /**\r\n   * \u6BCF\u4E2A\u6D88\u8D39\u8005\u6700\u957F\u6D88\u8D39\u65F6\u957F\r\n   * \u540C\u6B65\u963B\u585E\u578B\u4EE3\u7801\u8BA1\u7B97\u6240\u82B1\u65F6\u957F\u4E0D\u8BA1\u7B97\u5165\u5185\uFF0C\u4EC5\u4EC5\u63A7\u5236\u5F02\u6B65\u6D88\u8D39\u8005\u6D88\u8D39\u4EE3\u7801\u6240\u82B1\u65F6\u957F\r\n   * \u8BBE\u7F6E\u4E3A-1\u8868\u793A\u65E0\u65F6\u957F\u9650\u5236\r\n   * \u5728ask\u4E3Atrue\u548Casync\u4E3Afalse\u7684\u60C5\u51B5\u4E0B\u8BBE\u7F6EmaxTime\u4E3A-1\u53EF\u80FD\u4F1A\u5BFC\u81F4\u961F\u5217\u5C06\u88AB\u963B\u585E\r\n   */\r\n  maxTime: number = 3000;\r\n  /**\r\n   * \u6D88\u606F list\r\n   */\r\n  private news: News<D>[] = [];\r\n  getNews() {\r\n    return this.news;\r\n  }\r\n\r\n  /**\r\n   * \u79FB\u9664\u6240\u6709\u6D88\u606F\r\n   * @returns\r\n   */\r\n  removeAllNews() {\r\n    this.news = [];\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * \u52A0\u5165\u6D88\u606F\r\n   * @param news\r\n   */\r\n  pushNews(news: News<D>) {\r\n    if (news.consumedTimes === -1) news.consumedTimes = this.rcn;\r\n\r\n    if (news.consumedTimes > 0) {\r\n      //\u8FC7\u6EE4\u91CD\u590D\u7684\u6D88\u606Fid\r\n      if (this.news.findIndex((item) => item.getId() === news.getId()) === -1) {\r\n        this.operate(\"beforeAddNews\", news).then((isOk) => {\r\n          if (!isOk) return;\r\n          this.news.push(news);\r\n          this.operate(\"addedNews\", news);\r\n          if (this.news.length > 0 && this.consumerList.length > 0) this.consumeNews();\r\n        });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \u52A0\u5165\u6D88\u606F\u5185\u5BB9\r\n   * @param content\r\n   */\r\n  pushContent(content: D) {\r\n    const news = new News(content);\r\n    this.pushNews(news);\r\n  }\r\n  /**\r\n   * \u901A\u8FC7id\u79FB\u9664\u6307\u5B9A\u6D88\u606F\r\n   * @param newsId\r\n   * @returns\r\n   */\r\n  removeNewsById(newsId: string) {\r\n    const index = this.news.findIndex((item) => item.getId() === newsId);\r\n    if (index === -1) return false;\r\n    this.news.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * \u6D88\u8D39\u8005 list\r\n   */\r\n  private consumerList: Consumer<D>[] = [];\r\n  getConsumerList() {\r\n    return this.consumerList;\r\n  }\r\n  /**\r\n   * \u52A0\u5165\u6D88\u8D39\u8005\r\n   * @param consumerList\r\n   */\r\n  pushConsumer(consumer: Consumer<D>) {\r\n    //\u8FC7\u6EE4\u91CD\u590D\u7684\u6D88\u8D39\u8005id\r\n    if (this.consumerList.findIndex((item) => item.getId() === consumer.getId()) === -1) {\r\n      //TODO:\u6682\u4E0D\u80FD\u9650\u5236\u5F00\u53D1\u8005\u7ED1\u5B9A\u6D88\u8D39\u8005\r\n      // this.operate(\"beforeAddConsumer\", consumer).then((isOk) => {\r\n      //   if (!isOk) return;\r\n      //   this.consumerList.push(consumer);\r\n      //   if (this.news.length > 0 && this.consumerList.length > 0) this.consumeNews();\r\n      //   this.operate(\"addedConsumer\", consumer);\r\n      // });\r\n      this.consumerList.push(consumer);\r\n      this.operate(\"addedConsumer\", consumer);\r\n      if (this.news.length > 0 && this.consumerList.length > 0) this.consumeNews();\r\n    }\r\n  }\r\n  /**\r\n   *\r\n   * \u901A\u8FC7\u6D88\u8D39\u65B9\u6CD5\u79FB\u9664\u6307\u5B9A\u6D88\u8D39\u8005\r\n   * @param consume\r\n   * @returns\r\n   */\r\n  removeConsumer(consume: Consume<D>) {\r\n    const index = this.consumerList.findIndex((item) => item.consume === consume);\r\n    if (index === -1) return false;\r\n    const consumerList = this.consumerList.splice(index, 1);\r\n    this.operate(\"removedConsumer\", consumerList);\r\n    return true;\r\n  }\r\n  /**\r\n   * \u52A0\u5165\u6D88\u8D39\u8005\u6D88\u8D39\u4E3B\u4F53\r\n   *\r\n   * @param consume\r\n   * @param payload \u6D88\u8D39\u8F7D\u4F53\uFF0C\u6BCF\u6B21\u6D88\u8D39\u90FD\u4F1A\u4F20\u5165\u7ED9\u6D88\u8D39\u8005\r\n   */\r\n  pushConsume(consume: Consume<D>, payload?: any) {\r\n    const consumer = new Consumer(consume, payload);\r\n    this.pushConsumer(consumer);\r\n  }\r\n\r\n  /**\r\n   * \u901A\u8FC7id\u79FB\u9664\u6307\u5B9A\u6D88\u8D39\u8005\r\n   * @param consumerId\r\n   * @returns\r\n   */\r\n  removeConsumerById(consumerId: string) {\r\n    const index = this.consumerList.findIndex((item) => item.getId() === consumerId);\r\n    if (index === -1) return false;\r\n    const consumerList = this.consumerList.splice(index, 1);\r\n    this.operate(\"removedConsumer\", consumerList);\r\n    return true;\r\n  }\r\n  /**\r\n   * \u79FB\u9664\u6240\u6709\u6D88\u8D39\u8005\r\n   * @returns\r\n   */\r\n  removeAllConsumer() {\r\n    const consumerList = this.consumerList.splice(0);\r\n    this.operate(\"removedConsumer\", consumerList);\r\n    return true;\r\n  }\r\n  /**\r\n   * \u64CD\u4F5C\u7B26\u96C6\u5408\r\n   */\r\n  private operators: Operator<D>[] = [];\r\n\r\n  /**\r\n   * \u6DFB\u52A0\u94A9\u5B50\u51FD\u6570\u65B9\u6CD5\r\n   * @param operator\r\n   * @returns\r\n   */\r\n  add(operator: Operator<D>) {\r\n    this.operators.push(operator);\r\n    if (operator?.mounted) operator!.mounted(this);\r\n    return this;\r\n  }\r\n  /**\r\n   * \u7BA1\u9053\u64CD\u4F5C\u7B26\u6267\u884C\r\n   * \u5176\u4E2D\u9700\u8981\u963B\u585E\u83B7\u53D6\u8FD4\u56DE\u503C\uFF08boolea\uFF09\u7684\u662F\u6309\u987A\u5E8F\u6267\u884C\u7684\uFF0C\u5982\u679C\u4E0D\u9700\u8981\r\n   * @param fun\r\n   * @param args\r\n   * @returns\r\n   */\r\n  private async operate(fun: keyof Operator<D>, ...args: any[]) {\r\n    //\u5148\u8FC7\u6EE4\u6570\u636E\r\n    const list = this.operators\r\n      .filter((operator) => operator[fun])\r\n      //\r\n      .map((operator) => operator[fun]);\r\n    if (isAsyncOperator(fun)) {\r\n      for (const iterator of list) {\r\n        //\u5F02\u6B65\u5904\u7406\r\n        iterator?.(arguments[1]);\r\n      }\r\n    } else if (isSyncOperator(fun)) {\r\n      //\u540C\u6B65\u5904\u7406\r\n      for (const iterator of list) {\r\n        if (!(await iterator?.(arguments[1]))) return false;\r\n      }\r\n    }\r\n    //\u7C7B\u578B\u5F02\u5E38\r\n    else throw \"operate error\";\r\n\r\n    return true;\r\n  }\r\n  constructor(option?: Option<D>) {\r\n    Object.assign(this, option);\r\n  }\r\n\r\n  /**\r\n   * \u6D88\u8D39\u65B9\u6CD5\r\n   * \u6BCF\u6B21\u6267\u884C\u6D88\u8D39\u4E00\u6761\u6D88\u606F\r\n   * @returns\r\n   */\r\n  async consumeNews() {\r\n    if (this.news.length === 0) return;\r\n    if (this.consumerList.length === 0) return;\r\n    if (!this.async && this.state) return;\r\n\r\n    //\u5148\u628A\u72B6\u6001\u8BBE\u7F6E\u4E3A\u6D88\u8D39\u4E2D\r\n    this.state = true;\r\n\r\n    const consumerList =\r\n      this.mode === ConsumMode.Random\r\n        ? [this.consumerList[Math.round(Math.random() * (this.consumerList.length - 1))]]\r\n        : [...this.consumerList];\r\n\r\n    const news = this.news.splice(0, 1)[0];\r\n\r\n    //\u5982\u679C\u662F\u540C\u6B65\u7684\u5C31\u76F4\u63A5\u6267\u884C\u4E0B\u4E00\u4E2A\u6D88\u606F\uFF0C\u56E0\u4E3A\u4E0B\u9762\u662F\u5F02\u6B65\u65B9\u6CD5\r\n    this.consumeNews();\r\n\r\n    if (!(await this.operate(\"ejectedNews\", news))) {\r\n      this.state = false;\r\n      this.consumeNews();\r\n      return;\r\n    }\r\n\r\n    Promise.all(consumerList.map((consumer) => this.consumption(news, consumer)))\r\n      .then(() => {\r\n        //\u6D88\u606F\u88AB\u6210\u529F\u6D88\u8D39\r\n      })\r\n      .catch(() => {\r\n        //\u6D88\u8D39\u5931\u8D25\r\n        news.consumedTimes--;\r\n        this.pushNews(news);\r\n      })\r\n      .finally(() => {\r\n        this.state = false;\r\n        this.consumeNews();\r\n      });\r\n  }\r\n  /**\r\n   * \u6307\u5B9A\u6D88\u8D39\u8005\u6D88\u8D39\u67D0\u4E00\u6761\u6D88\u606F\u7684\u65B9\u6CD5\r\n   * @param news\r\n   * @param consumer\r\n   * @returns\r\n   */\r\n  consumption(news: News<D>, consumer: Consumer<D>): Promise<boolean> {\r\n    return new Promise<boolean>((resolve, reject) => {\r\n      const maxTime = this.maxTime;\r\n      const id =\r\n        maxTime >= 0\r\n          ? setTimeout(() => {\r\n              // Logs.log(`\u961F\u5217 \u6D88\u8D39\u8D85\u65F6`);\r\n              reject(false);\r\n            }, maxTime)\r\n          : undefined;\r\n\r\n      consumer.consumption(news, this.ask).then((isOk: boolean) => {\r\n        if (isOk) {\r\n          // Logs.log(`\u961F\u5217 \u6D88\u8D39\u6210\u529F`);\r\n          resolve(isOk);\r\n        } else {\r\n          // Logs.log(`\u961F\u5217 \u6D88\u8D39\u5931\u8D25`);\r\n          reject(isOk);\r\n        }\r\n        if (maxTime >= 0) clearTimeout(id);\r\n      });\r\n    });\r\n  }\r\n}\r\n", "/**\r\n * \u997C\u5E73\u5316\u65B9\u4FBF\u53D6\u503C\r\n * \u4F46\u662F\u9700\u8981\u6807\u8BB0\u6BCF\u4E2Awindow\u5728\u591A\u7EF4\u6570\u7EC4\u4E2D\u7684\u4F4D\u7F6E\r\n * window\u4E3A\u7B2C\u4E00\u5C42\uFF0C\u8BB0\u4E3A0\uFF0C0\r\n * window\u4E0B\u7B2C\u4E00\u4E2Aiframe\u8BB0\u4E3A0\uFF0C1\r\n * y \u662F\u6DF1\u5EA6\r\n *\r\n * x \u662F\u7D22\u5F15\r\n *\r\n * \u53EA\u8981\u6709\u4E00\u4E2Awindow\u4EA7\u751F\u5C31\u5168\u5C40\u6838\u5BF9\u5750\u6807\u70B9\r\n * \u53EA\u8981\u6709\u4E00\u4E2AIframeMessage\u88AB\u521B\u5EFA\u5219\u4EE3\u8868\u5F53\u524D\u521B\u5EFA\u4E86\u4E00\u4E2Awindow\r\n *\r\n *\r\n */\r\n\r\n/**\r\n * \u83B7\u53D6\u5176\u4ED6\u6240\u6709Iframe doc\r\n * @returns\r\n */\r\nexport function getOtherAllIframeDoc(): T[] {\r\n  if (window.top === null) throw \"window.top is null\";\r\n  const list = getAllIframeDoc(window.top, 0, 0);\r\n  return list.filter((item) => item.window !== window.self);\r\n}\r\n/**\r\n * \u83B7\u53D6\u81EA\u5DF1\u7684iframe doc\r\n * @returns\r\n */\r\nexport function getSelfIframeDoc() {\r\n  if (window.top === null) throw \"window.top is null\";\r\n  const list = getAllIframeDoc(window.top, 0, 0);\r\n  return list.find((item) => item.window === window.self);\r\n}\r\ntype T = {\r\n  window: Window;\r\n  x: number;\r\n  y: number;\r\n};\r\n/**\r\n * \u83B7\u53D6\u6240\u6709node doc\r\n * @param w\r\n * @param x\r\n * @param y\r\n * @returns\r\n */\r\nexport function getAllIframeDoc(w: Window, x: number, y: number): T[] {\r\n  const arr = [];\r\n  arr.push({\r\n    window: w,\r\n    x,\r\n    y,\r\n  });\r\n  y += 1;\r\n  for (let k = 0; k < w.length; k++) {\r\n    arr.push(...getAllIframeDoc(w[k], x, y));\r\n    x += 1;\r\n  }\r\n  return arr;\r\n}\r\n", "import UNodeMQ, { Exchange, isObject, isString, Queue } from \"../../index\";\r\nimport { getOtherAllIframeDoc } from \"./loader\";\r\n/**\r\n * \u4F7F\u7528postMessage\u8FDB\u884Ciframe\u8DE8\u57DF\u901A\u4FE1\r\n */\r\n//TODO:\u89E3\u51B3\u63D2\u4EF6\u5F15\u7528\u8DEF\u5F84\u957F\u5EA6\u95EE\u9898\r\n//TODO:\u8DE8iframe\u5171\u4EABstorage\r\n//TODO:\u5355\u5143\u6D4B\u8BD5\u6846\u67B6\u96C6\u6210\r\nexport enum MessageType {\r\n  GeneralMessage, //\u666E\u901A\u6D88\u606F\r\n  FindExchangeMessage, //\u5E7F\u64AD\u67E5\u627E\u4EA4\u6362\u673A\u6D88\u606F\r\n  SendCoordinateMessage, //\u53D1\u9001exchange\u5750\u6807\u6D88\u606F\r\n  OnlineNotificationMessage, //\u4E0A\u7EBF\u901A\u77E5\u6D88\u606F\r\n}\r\n//\u76F4\u53D1\u6D88\u606F\u961F\u5217\uFF0C\u5373\u4E3B\u52A8\u53D1\u9001\r\nexport const getInternalIframeMessageQueueName = (queueName: string) => queueName + \"_Iframe_Message\";\r\n//\u7528\u6765\u5E7F\u64AD\u83B7\u53D6\u5730\u5740\u7684\u6D88\u606F\r\nexport const getInternalIframeBroadcasMessageQueueName = (queueName: string) => queueName + \"_Iframe_Wait_Message\";\r\n\r\nexport default class IframePlugin {\r\n  private unmq: UNodeMQ<Record<string, Exchange<any>>, Record<string, Queue<any>>> | null = null;\r\n  constructor(private readonly name: string) {\r\n    this.name = name;\r\n  }\r\n  install(unmq: UNodeMQ<Record<string, Exchange<any>>, Record<string, Queue<any>>>, ...options: any[]) {\r\n    const selfExchange = unmq.getExchange(this.name);\r\n    if (!selfExchange) {\r\n      throw `${this.name}\u4EA4\u6362\u673A\u4E0D\u5B58\u5728`;\r\n    }\r\n    this.unmq = unmq;\r\n    const list = unmq.getExchangeList();\r\n    const otherIframe = list.filter((item) => item.name !== this.name);\r\n\r\n    for (const iframe of otherIframe) {\r\n      if (iframe.name === undefined) throw `\u7CFB\u7EDF\u9519\u8BEF`;\r\n      iframe.setRepeater(() => [\r\n        getInternalIframeMessageQueueName(iframe.name as string),\r\n        getInternalIframeBroadcasMessageQueueName(iframe.name as string),\r\n      ]);\r\n      //\u7528\u4E8E\u5B58\u50A8\u6D88\u606F\u7684\u961F\u5217\r\n      unmq.addQueue(new Queue({ name: getInternalIframeMessageQueueName(iframe.name), async: true }));\r\n      //\u7528\u6765\u5E7F\u64AD\u83B7\u53D6\u5730\u5740\u7684\u6D88\u606F\r\n      unmq.addQueue(new Queue({ name: getInternalIframeBroadcasMessageQueueName(iframe.name), async: true }));\r\n\r\n      //\u4E3A\u5E7F\u64AD\u6D88\u606F\u6302\u8F7D\u6D88\u8D39\u65B9\u6CD5\r\n      unmq.on(getInternalIframeBroadcasMessageQueueName(iframe.name), () => {\r\n        //\u5E7F\u64AD\u67E5\u627E\u4EA4\u6362\u673A\u5730\u5740\u6D88\u606F\r\n        this.broadcastMessage(MessageType.FindExchangeMessage, {\r\n          exchangeName: iframe.name,\r\n          msg: `who is ${iframe.name} ?`,\r\n        });\r\n      });\r\n    }\r\n\r\n    //\u5E7F\u64AD\u53D1\u9001\u4E0A\u7EBF\u901A\u77E5\r\n    this.broadcastMessage(MessageType.OnlineNotificationMessage, { msg: `${this.name} is online` });\r\n\r\n    //\u76D1\u542Cunmq\u7684\u6D88\u606F\r\n    window.addEventListener(\"message\", this.receiveMessage.bind(this), false);\r\n  }\r\n  /**\r\n   *\r\n   * @param param0\r\n   * @returns\r\n   */\r\n  private receiveMessage({ source, data, origin }: MessageEventInit) {\r\n    if (this.unmq === null) throw `${this.name} iframe \u672A\u5B89\u88C5`;\r\n    if (!isObject(data)) return;\r\n    const { mask, type, message, fromName } = data;\r\n    if (mask !== \"u-node-mq-plugin\") return;\r\n    if (source === null || source === undefined) return;\r\n    //\u53D1\u9001\u8005\u662F\u5426\u5B58\u5728\r\n    const fromIframe = this.unmq.getExchange(fromName);\r\n    if (!fromIframe) return;\r\n    //\u5224\u65AD\u771F\u5B9E\u7684origin \u662F\u5426\u662F\u6211\u60F3\u8981\u7684 origin\r\n    if (isString(fromIframe.origin) && fromIframe.origin !== origin) return;\r\n\r\n    if ([MessageType.OnlineNotificationMessage, MessageType.SendCoordinateMessage].indexOf(type) !== -1) {\r\n      // \u62FF\u5230\u5BF9\u65B9\u5750\u6807\uFF0C\u51C6\u5907\u53D1\u9001\u6D88\u606F\r\n      const off = this.unmq.on(getInternalIframeMessageQueueName(fromName), (data) => {\r\n        this.postMessage(source as Window, MessageType.GeneralMessage, data, origin);\r\n      });\r\n      setTimeout(off);\r\n      return true;\r\n    }\r\n\r\n    //\u666E\u901A\u6D88\u606F\r\n    if (type === MessageType.GeneralMessage) {\r\n      //\u53D1\u9001\u786E\u8BA4\u6536\u5230\u6D88\u606F\r\n      this.unmq.emit(this.name, message);\r\n      return true;\r\n    }\r\n\r\n    //\u67E5\u627E\u4EA4\u6362\u673A\u6D88\u606F\r\n    if (type === MessageType.FindExchangeMessage && message.exchangeName === this.name) {\r\n      this.postMessage(source as Window, MessageType.SendCoordinateMessage, { msg: `my name is ${this.name}` }, origin);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\u53D1\u9001\u6D88\u606F\r\n   * @param currentWindow\r\n   * @param type\r\n   * @param message\r\n   * @param origin\r\n   * @param transfer\r\n   */\r\n  private postMessage(\r\n    currentWindow: Window,\r\n    type: MessageType,\r\n    message: any,\r\n    origin: string = \"*\",\r\n    transfer?: Transferable[]\r\n  ) {\r\n    currentWindow.postMessage(\r\n      {\r\n        mask: \"u-node-mq-plugin\",\r\n        type,\r\n        message,\r\n        fromName: this.name,\r\n      },\r\n      origin,\r\n      transfer\r\n    );\r\n  }\r\n  /**\r\n   *\u5E7F\u64AD\u6D88\u606F\r\n   * @param type\r\n   * @param message\r\n   */\r\n  private broadcastMessage(type: MessageType, message: any) {\r\n    const list = getOtherAllIframeDoc();\r\n    list.forEach((item) => {\r\n      this.postMessage(item.window, type, message, \"*\");\r\n    });\r\n  }\r\n}\r\n", "import { Operator } from \"..\";\r\n/**\r\n * map \u65B9\u6CD5\u8FD4\u56DE\u7684\u6570\u636E\u7C7B\u578B\u548C\u961F\u5217\u4E00\u81F4\r\n * @param project\r\n * @returns\r\n */\r\n\r\nexport function map<D>(project: (value: D, index: number) => D): Operator<D> {\r\n  let index = 0;\r\n  return {\r\n    beforeAddNews(num) {\r\n      num.content = project(num.content, index);\r\n      index++;\r\n      return true;\r\n    },\r\n  };\r\n}\r\n", "import { Operator } from \"..\";\r\nimport Tools from \"../utils/tools\";\r\n\r\n/**\r\n * debounceTime \u9632\u6296\u51FD\u6570\r\n * @param dueTime \u6296\u52A8\u95F4\u9694\u65F6\u95F4\uFF0C\u5355\u4F4D\u6BEB\u79D2\r\n * @param immediate \u662F\u5426\u7ACB\u5373\u6267\u884C\uFF0C\u4E00\u822C\u4E0D\u7528\u7ACB\u5373\u6267\u884C\r\n * @returns\r\n */\r\nexport function debounceTime<D>(dueTime: number, immediate?: boolean): Operator<D> {\r\n  let now: number = 0;\r\n  let timeId: number | null = null;\r\n  let res: (value: boolean | PromiseLike<boolean>) => void;\r\n  return {\r\n    beforeAddNews() {\r\n      const t = new Date().getTime();\r\n      if (immediate) {\r\n        //\u7ACB\u5373\u6267\u884C\r\n        const n = now;\r\n        now = t;\r\n        return t > n + dueTime;\r\n      } else {\r\n        //\r\n        if (timeId !== null && t <= now + dueTime) {\r\n          res(false);\r\n          clearTimeout(timeId);\r\n        }\r\n        now = t;\r\n        return new Promise((resolve) => {\r\n          res = resolve;\r\n          timeId = setTimeout(() => {\r\n            timeId = null;\r\n            resolve(true);\r\n          }, dueTime);\r\n        });\r\n      }\r\n    },\r\n  };\r\n}\r\n", "import { Operator } from \"..\";\r\n\r\n/**\r\n * throttleTime \u8282\u6D41\u51FD\u6570\r\n * @param duration \u8282\u6D41\u95F4\u9694\u65F6\u95F4\uFF0C\u5355\u4F4D\u6BEB\u79D2\r\n * @param immediate \u662F\u5426\u7ACB\u5373\u6267\u884C\uFF0C\u4E00\u822C\u4E0D\u7528\u7ACB\u5373\u6267\u884C\uFF0C\u5982\u679C\u8BBE\u7F6E\u4E3Atrue\uFF0C\u5219\u4F1A\u62FF\u7B2C\u4E00\u6B21\u89E6\u53D1\u7684\u53C2\u6570\u5230\u7ED3\u675F\u65F6\u95F4\u6267\u884C\uFF0C\u800C\u4E0D\u662F\u62FF\u7ED3\u675F\u65F6\u95F4\u4E4B\u524D\u7684\u6700\u540E\u4E00\u6B21\u89E6\u53D1\u7684\u53C2\u6570\u53BB\u6267\u884C\r\n * \u4F8B\u5982\u5728\uFF0C1\u79D2\u5185\u89E6\u53D1\u4E865\u6B21\uFF0C\u4F20\u9012\u7684\u53C2\u6570\u4F9D\u6B21\u4E3A1\u30012\u30013\u30014\u30015\uFF0C\u5219\u4F1A\u5728\u7B2C1\u79D2\u5904\u6267\u884C\u53C2\u6570\u4E3A1\u7684\u65B9\u6CD5\r\n * @returns\r\n */\r\nexport function throttleTime<D>(duration: number, immediate?: boolean): Operator<D> {\r\n  let now: number = 0;\r\n  let timeId: number | null = null;\r\n  return {\r\n    beforeAddNews() {\r\n      const t = new Date().getTime();\r\n      if (immediate) {\r\n        //\u7ACB\u5373\u6267\u884C\r\n        if (t <= now + duration) return false;\r\n        now = t;\r\n        return true;\r\n      } else {\r\n        //\r\n        if (timeId !== null) return false;\r\n\r\n        return new Promise((resolve) => {\r\n          timeId = setTimeout(() => {\r\n            timeId = null;\r\n            resolve(true);\r\n          }, duration);\r\n        });\r\n      }\r\n    },\r\n  };\r\n}\r\n", "import { Operator } from \"..\";\r\n\r\n/**\r\n * task \u63A7\u5236\u961F\u5217\u80FD\u5B58\u5165\u51E0\u6761\u6D88\u606F\r\n * @param count\r\n * @returns\r\n */\r\nexport function task<D>(count: number): Operator<D> {\r\n  let seen = 0;\r\n  return {\r\n    beforeAddNews() {\r\n      return ++seen <= count;\r\n    },\r\n  };\r\n}\r\n", "import { Operator } from \"..\";\r\nimport News from \"../internal/News\";\r\n\r\n/**\r\n * newsTime \u8BBE\u7F6E\u6D88\u606F\u5B58\u6D3B\u65F6\u957F\r\n * @param time \u5B58\u6D3B\u65F6\u957F\u6BEB\u79D2\u6570\r\n * @returns\r\n */\r\nexport function newsTime<D>(time: number): Operator<D> {\r\n  return {\r\n    ejectedNews(news: News<any>) {\r\n      return new Date().getTime() < time + news.createTime;\r\n    },\r\n  };\r\n}\r\n", "import { Operator, Queue } from \"..\";\r\n\r\n/**\r\n * \u63D0\u524D\u53D1\u5C04\u6570\u636E\uFF0C\u53EF\u7528\u6765\u8BBE\u7F6E\u9ED8\u8BA4\u503C\u6216\u8005\u7528\u6765\u5FEB\u901F\u6D4B\u8BD5\r\n * @param count\r\n * @returns\r\n */\r\nexport function of<D>(...args: D[]): Operator<D> {\r\n  return {\r\n    mounted(queue: Queue<D>) {\r\n      args.forEach((item) => {\r\n        queue.pushContent(item);\r\n      });\r\n    },\r\n  };\r\n}\r\n", "import { Operator, Queue, Consumer } from \"..\";\r\n\r\n/**\r\n * \u7BA1\u9053\u64CD\u4F5C\u65B9\u6CD5\u662F\u53EF\u4EE5\u968F\u610F\u7EC4\u5408\u7684\uFF0C\u5373\u4F7F\u5728interval\u4E4B\u524D\u8FD8\u6709\u5176\u5B83\u64CD\u4F5C\u65B9\u6CD5\u4E5F\u4E0D\u5F71\u54CDsetInterval\u7684\u7EE7\u7EED\u8FD0\u884C\r\n *\r\n * \u5728ts\u6587\u4EF6\u4E2D\u4F7F\u7528interval\u961F\u5217\u5185\u5BB9\u5FC5\u987B\u4E3Anumber\r\n *\r\n * \u52A0\u5165\u7684\u6D88\u606F\u5185\u5BB9\u4ECE1\u5F00\u59CB\r\n *\r\n * setinterval\u53D1\u5C04\u6570\u636E\uFF0C\u53D1\u5C04\u5185\u5BB9\u4E3A\u4ECE0\u5F00\u59CB\u7684\u6570\u5B57\r\n * @param period \u95F4\u9694\u65F6\u957F\r\n * @param optimal \u662F\u5426\u5728\u6CA1\u6709\u6D88\u8D39\u8005\u7684\u65F6\u5019\u6682\u505C\u53D1\u5C04\u6570\u636E\uFF0C\u6709\u6D88\u8D39\u8005\u5219\u4F1A\u81EA\u52A8\u5F00\u542F\u53D1\u5C04\r\n * @returns\r\n */\r\n\r\nexport function interval(period = 1000, optimal = true): Operator<number> {\r\n  if (period < 0) period = 0;\r\n  let num = 0;\r\n  let id: number | null = null;\r\n  let interval = {\r\n    go: () => {},\r\n    stop: () => {},\r\n  };\r\n  let queue: Queue<number>;\r\n\r\n  return {\r\n    mounted(that: Queue<number>) {\r\n      // (function () { })();\r\n      queue = that;\r\n      interval = {\r\n        go() {\r\n          id = setInterval(() => {\r\n            num++;\r\n            queue.pushContent(num);\r\n          }, period);\r\n        },\r\n        stop() {\r\n          if (id === null) return;\r\n          clearInterval(id);\r\n          id = null;\r\n        },\r\n      };\r\n\r\n      if (queue.getConsumerList.length > 0) {\r\n        //\u6709\u9ED8\u8BA4\u6D88\u8D39\u8005\r\n        interval.go();\r\n      } else if (!optimal) {\r\n        interval.go();\r\n      }\r\n    },\r\n    addedConsumer() {\r\n      //\u5982\u679C\u4E0D\u542F\u7528\u8BE5\u5C5E\u6027\u5219\u76F4\u63A5\u9000\u51FA\r\n      if (!optimal) return;\r\n      //\u5224\u65AD\u662F\u5426\u4EE5\u53CA\u5728\u5FAA\u73AF\u6267\u884C\u4E86\r\n      if (id !== null) return;\r\n\r\n      interval.go();\r\n    },\r\n    removedConsumer(consumerList: Consumer<number>[]) {\r\n      if (!optimal) return;\r\n      //\u5224\u65AD\u662F\u5426\u4EE5\u53CA\u5728\u5FAA\u73AF\u6267\u884C\u4E86\r\n      if (id === null) return;\r\n\r\n      if (queue.getConsumerList.length === 0) interval.stop();\r\n      return \"\";\r\n    },\r\n  };\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
